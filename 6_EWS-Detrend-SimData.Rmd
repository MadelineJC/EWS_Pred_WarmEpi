# Looking for EWS in Detrended Simulated and Empirical Data

## Required Packages

```{r}
require(scales)
require(evobiR)
require(gdata)
require(doBy)
require(ecp)
require(strucchange)
require(TTR)
require(moments)
```

# Simulated Data

Both of these data frames are 120 rows (days) by 1000 columns (populations).

```{r}
head(smoothed.const.df)
head(smoothed.warm.df)
```

# Calculating Statistical Metrics Along Variously-Sized Sliding Windows

For details on these metrics, see `3_EWS-Sim.Rmd`.

## 5 Day Sliding Window

### Standard Deviation, Mean, Skewness, Kurtosis

```{r}
num.of.sims <- 10^3

# Making empty matricies
constant.sims.sd.5 <- matrix(nrow = 115, ncol = num.of.sims)
constant.sims.mean.5 <- matrix(nrow = 115, ncol = num.of.sims)
constant.sims.skewness.5 <- matrix(nrow = 115, ncol = num.of.sims)
constant.sims.kurtosis.5 <- matrix(nrow = 115, ncol = num.of.sims)

warming.sims.sd.5 <- matrix(nrow = 115, ncol = num.of.sims)
warming.sims.mean.5 <- matrix(nrow = 115, ncol = num.of.sims)
warming.sims.skewness.5 <- matrix(nrow = 115, ncol = num.of.sims)
warming.sims.kurtosis.5 <- matrix(nrow = 115, ncol = num.of.sims)

# Use SlidingWindow to calculate sd, mean, skewness, and kurtosis
for(i in 1:num.of.sims){
  constant.sims.sd.5[ ,i] <- SlidingWindow(FUN = "sd", data = smoothed.const.df[,i], window = 5,step = 1)
  constant.sims.mean.5[ ,i] <- SlidingWindow(FUN = "mean", data = smoothed.const.df[,i], window = 5, step = 1)
  constant.sims.skewness.5[ ,i] <- SlidingWindow(FUN = "skewness", data = smoothed.const.df[,i], window = 5, step = 1)
  constant.sims.kurtosis.5[ ,i] <- SlidingWindow(FUN = "kurtosis", data = smoothed.const.df[,i], window = 5, step = 1)
}

for(i in 1:num.of.sims){
  warming.sims.sd.5[ ,i] <- SlidingWindow(FUN = "sd", data = smoothed.warm.df[,i], window = 5,step = 1)
  warming.sims.mean.5[ ,i] <- SlidingWindow(FUN = "mean", data = smoothed.warm.df[,i], window = 5, step = 1)
  warming.sims.skewness.5[ ,i] <- SlidingWindow(FUN = "skewness", data = smoothed.warm.df[,i], window = 5, step = 1)
  warming.sims.kurtosis.5[ ,i] <- SlidingWindow(FUN = "kurtosis", data = smoothed.warm.df[,i], window = 5, step = 1)
}
```

### Variation

```{r}
constant.sims.variance.5 <- constant.sims.sd.5*constant.sims.sd.5
warming.sims.variance.5 <- warming.sims.sd.5*warming.sims.sd.5
```

### Co-Efficient of Variation

```{r}
constant.sims.cv.5 <- constant.sims.sd.5/constant.sims.mean.5
warming.sims.cv.5 <- warming.sims.sd.5/warming.sims.mean.5
```

### Index of Dispersion

```{r}
constant.sims.id.5 <- constant.sims.variance.5/constant.sims.mean.5
warming.sims.id.5 <- warming.sims.variance.5/warming.sims.mean.5
```

### First Difference Variance

```{r}
constant.sims.first.diff.variance.5 <- matrix(ncol = num.of.sims, nrow = 115)
warming.sims.first.diff.variance.5 <- matrix(ncol = num.of.sims, nrow = 115)

for(i in 1:num.of.sims){
  for(j in 2:115){
    constant.sims.first.diff.variance.5[j - 1,i] <- constant.sims.variance.5[j,i] - constant.sims.variance.5[j - 1,i]
    warming.sims.first.diff.variance.5[j - 1,i] <- warming.sims.variance.5[j,i] - warming.sims.variance.5[j - 1,i]
  }
}

# Get rid of NA (last) row
constant.sims.first.diff.variance.5 <- constant.sims.first.diff.variance.5[1:114, ]
warming.sims.first.diff.variance.5 <- warming.sims.first.diff.variance.5[1:114, ]
```

### Autocorrelation and Autocovariance

```{r}
constant.sims.cor.5 <- matrix(ncol = num.of.sims, nrow = 120)
constant.sims.cov.5 <- matrix(ncol = num.of.sims, nrow = 120)

for(j in 1:num.of.sims){
  for(i in 1:115){
    window.start <- i
    window.end <- i + 4
    
    segment <- smoothed.const.df[c(window.start:window.end),j]
    
    constant.sims.cor.5[i,j] <- acf(segment, plot = FALSE, type = "correlation")[[1]][2]
    constant.sims.cov.5[i,j] <- acf(segment, plot = FALSE, type = "covariance")[[1]][2]
  }
}

warming.sims.cor.5 <- matrix(ncol=num.of.sims,nrow = 120)
warming.sims.cov.5 <- matrix(ncol=num.of.sims,nrow = 120)

for(j in 1:num.of.sims){
  for(i in 1:115){
    window.start <- i
    window.end <- i + 4
    
    segment <- smoothed.warm.df[c(window.start:window.end),j]
    
    warming.sims.cor.5[i,j] <- acf(segment, plot = FALSE, type = "correlation")[[1]][2]
    warming.sims.cov.5[i,j] <- acf(segment, plot = FALSE, type = "covariance")[[1]][2]
  }
}
```

### Decay Time

```{r}
constant.sims.decay.time.5 <- matrix(ncol = num.of.sims, nrow = 55)
warming.sims.decay.time.5 <- matrix(nco = num.of.sims, nrow = 55)

for(i in 1:num.of.sims){
  for(j in 1:55){
    suppressWarnings(constant.sims.decay.time.5[j, i] <- -j/log(constant.sims.cor.5[j, i]))
    suppressWarnings(warming.sims.decay.time.5[j, i] <- -j/log(warming.sims.cor.5[j, i]))
  }
}
```

## 15 Day Sliding Window

### Standard Deviation, Mean, Skewness, Kurtosis

```{r}
num.of.sims <- 10^3

# Making empty matricies
constant.sims.sd.15 <- matrix(nrow = 105, ncol = num.of.sims)
constant.sims.mean.15 <- matrix(nrow = 105, ncol = num.of.sims)
constant.sims.skewness.15 <- matrix(nrow = 105, ncol = num.of.sims)
constant.sims.kurtosis.15 <- matrix(nrow = 105, ncol = num.of.sims)

warming.sims.sd.15 <- matrix(nrow = 105, ncol = num.of.sims)
warming.sims.mean.15 <- matrix(nrow = 105, ncol = num.of.sims)
warming.sims.skewness.15 <- matrix(nrow = 105, ncol = num.of.sims)
warming.sims.kurtosis.15 <- matrix(nrow = 105, ncol = num.of.sims)

# Use SlidingWindow to calculate sd, mean, skewness, and kurtosis
for(i in 1:num.of.sims){
  constant.sims.sd.15[ ,i] <- SlidingWindow(FUN = "sd", data = smoothed.const.df[,i], window = 15,step = 1)
  constant.sims.mean.15[ ,i] <- SlidingWindow(FUN = "mean", data = smoothed.const.df[,i], window = 15, step = 1)
  constant.sims.skewness.15[ ,i] <- SlidingWindow(FUN = "skewness", data = smoothed.const.df[,i], window = 15, step = 1)
  constant.sims.kurtosis.15[ ,i] <- SlidingWindow(FUN = "kurtosis", data = smoothed.const.df[,i], window = 15, step = 1)
}

for(i in 1:num.of.sims){
  warming.sims.sd.15[ ,i] <- SlidingWindow(FUN = "sd", data = smoothed.warm.df[,i], window = 15,step = 1)
  warming.sims.mean.15[ ,i] <- SlidingWindow(FUN = "mean", data = smoothed.warm.df[,i], window = 15, step = 1)
  warming.sims.skewness.15[ ,i] <- SlidingWindow(FUN = "skewness", data = smoothed.warm.df[,i], window = 15, step = 1)
  warming.sims.kurtosis.15[ ,i] <- SlidingWindow(FUN = "kurtosis", data = smoothed.warm.df[,i], window = 15, step = 1)
}
```

### Variation

```{r}
constant.sims.variance.15 <- constant.sims.sd.15*constant.sims.sd.15
warming.sims.variance.15 <- warming.sims.sd.15*warming.sims.sd.15
```

### Co-Efficient of Variation

```{r}
constant.sims.cv.15 <- constant.sims.sd.15/constant.sims.mean.15
warming.sims.cv.15 <- warming.sims.sd.15/warming.sims.mean.15
```

### Index of Dispersion

```{r}
constant.sims.id.15 <- constant.sims.variance.15/constant.sims.mean.15
warming.sims.id.15 <- warming.sims.variance.15/warming.sims.mean.15
```

### First Difference Variance

```{r}
constant.sims.first.diff.variance.15 <- matrix(ncol = num.of.sims, nrow = 105)
warming.sims.first.diff.variance.15 <- matrix(ncol = num.of.sims, nrow = 105)

for(i in 1:num.of.sims){
  for(j in 2:105){
    constant.sims.first.diff.variance.15[j - 1,i] <- constant.sims.variance.15[j,i] - constant.sims.variance.15[j - 1,i]
    warming.sims.first.diff.variance.15[j - 1,i] <- warming.sims.variance.15[j,i] - warming.sims.variance.15[j - 1,i]
  }
}

# Get rid of NA (last) row
constant.sims.first.diff.variance.15 <- constant.sims.first.diff.variance.15[1:104, ]
warming.sims.first.diff.variance.15 <- warming.sims.first.diff.variance.15[1:104, ]
```

### Autocorrelation and Autocovariance

```{r}
constant.sims.cor.15 <- matrix(ncol = num.of.sims, nrow = 120)
constant.sims.cov.15 <- matrix(ncol = num.of.sims, nrow = 120)

for(j in 1:num.of.sims){
  for(i in 1:105){
    window.start <- i
    window.end <- i + 14
    
    segment <- smoothed.const.df[c(window.start:window.end),j]
    
    constant.sims.cor.15[i,j] <- acf(segment, plot = FALSE, type = "correlation")[[1]][2]
    constant.sims.cov.15[i,j] <- acf(segment, plot = FALSE, type = "covariance")[[1]][2]
  }
}

warming.sims.cor.15 <- matrix(ncol=num.of.sims,nrow = 120)
warming.sims.cov.15 <- matrix(ncol=num.of.sims,nrow = 120)

for(j in 1:num.of.sims){
  for(i in 1:105){
    window.start <- i
    window.end <- i + 14
    
    segment <- smoothed.warm.df[c(window.start:window.end),j]
    
    warming.sims.cor.15[i,j] <- acf(segment, plot = FALSE, type = "correlation")[[1]][2]
    warming.sims.cov.15[i,j] <- acf(segment, plot = FALSE, type = "covariance")[[1]][2]
  }
}
```

### Decay Time

```{r}
constant.sims.decay.time.15 <- matrix(ncol = num.of.sims, nrow = 45)
warming.sims.decay.time.15 <- matrix(nco = num.of.sims, nrow = 45)

for(i in 1:num.of.sims){
  for(j in 1:45){
    suppressWarnings(constant.sims.decay.time.15[j, i] <- -j/log(constant.sims.cor.15[j, i]))
    suppressWarnings(warming.sims.decay.time.15[j, i] <- -j/log(warming.sims.cor.15[j, i]))
  }
}
```

## 30 Day Sliding Window

### Standard Deviation, Mean, Skewness, Kurtosis

```{r}
num.of.sims <- 10^3

# Making empty matricies
constant.sims.sd.30 <- matrix(nrow = 90, ncol = num.of.sims)
constant.sims.mean.30 <- matrix(nrow = 90, ncol = num.of.sims)
constant.sims.skewness.30 <- matrix(nrow = 90, ncol = num.of.sims)
constant.sims.kurtosis.30 <- matrix(nrow = 90, ncol = num.of.sims)

warming.sims.sd.30 <- matrix(nrow = 90, ncol = num.of.sims)
warming.sims.mean.30 <- matrix(nrow = 90, ncol = num.of.sims)
warming.sims.skewness.30 <- matrix(nrow = 90, ncol = num.of.sims)
warming.sims.kurtosis.30 <- matrix(nrow = 90, ncol = num.of.sims)

# Use SlidingWindow to calculate sd, mean, skewness, and kurtosis
for(i in 1:num.of.sims){
  constant.sims.sd.30[ ,i] <- SlidingWindow(FUN = "sd", data = smoothed.const.df[,i], window = 30,step = 1)
  constant.sims.mean.30[ ,i] <- SlidingWindow(FUN = "mean", data = smoothed.const.df[,i], window = 30, step = 1)
  constant.sims.skewness.30[ ,i] <- SlidingWindow(FUN = "skewness", data = smoothed.const.df[,i], window = 30, step = 1)
  constant.sims.kurtosis.30[ ,i] <- SlidingWindow(FUN = "kurtosis", data = smoothed.const.df[,i], window = 30, step = 1)
}

for(i in 1:num.of.sims){
  warming.sims.sd.30[ ,i] <- SlidingWindow(FUN = "sd", data = smoothed.warm.df[,i], window = 30,step = 1)
  warming.sims.mean.30[ ,i] <- SlidingWindow(FUN = "mean", data = smoothed.warm.df[,i], window = 30, step = 1)
  warming.sims.skewness.30[ ,i] <- SlidingWindow(FUN = "skewness", data = smoothed.warm.df[,i], window = 30, step = 1)
  warming.sims.kurtosis.30[ ,i] <- SlidingWindow(FUN = "kurtosis", data = smoothed.warm.df[,i], window = 30, step = 1)
}
```

### Variation

```{r}
constant.sims.variance.30 <- constant.sims.sd.30*constant.sims.sd.30
warming.sims.variance.30 <- warming.sims.sd.30*warming.sims.sd.30
```

### Co-Efficient of Variation

```{r}
constant.sims.cv.30 <- constant.sims.sd.30/constant.sims.mean.30
warming.sims.cv.30 <- warming.sims.sd.30/warming.sims.mean.30
```

### Index of Dispersion

```{r}
constant.sims.id.30 <- constant.sims.variance.30/constant.sims.mean.30
warming.sims.id.30 <- warming.sims.variance.30/warming.sims.mean.30
```

### First Difference Variance

```{r}
constant.sims.first.diff.variance.30 <- matrix(ncol = num.of.sims, nrow = 90)
warming.sims.first.diff.variance.30 <- matrix(ncol = num.of.sims, nrow = 90)

for(i in 1:num.of.sims){
  for(j in 2:90){
    constant.sims.first.diff.variance.30[j - 1,i] <- constant.sims.variance.30[j,i] - constant.sims.variance.30[j - 1,i]
    warming.sims.first.diff.variance.30[j - 1,i] <- warming.sims.variance.30[j,i] - warming.sims.variance.30[j - 1,i]
  }
}

# Get rid of NA (last) row
constant.sims.first.diff.variance.30 <- constant.sims.first.diff.variance.30[1:89, ]
warming.sims.first.diff.variance.30 <- warming.sims.first.diff.variance.30[1:89, ]
```

### Autocorrelation and Autocovariance

```{r}
constant.sims.cor.30 <- matrix(ncol = num.of.sims, nrow = 120)
constant.sims.cov.30 <- matrix(ncol = num.of.sims, nrow = 120)

for(j in 1:num.of.sims){
  for(i in 1:90){
    window.start <- i
    window.end <- i + 29
    
    segment <- smoothed.const.df[c(window.start:window.end),j]
    
    constant.sims.cor.30[i,j] <- acf(segment, plot = FALSE, type = "correlation")[[1]][2]
    constant.sims.cov.30[i,j] <- acf(segment, plot = FALSE, type = "covariance")[[1]][2]
  }
}

warming.sims.cor.30 <- matrix(ncol=num.of.sims,nrow = 120)
warming.sims.cov.30 <- matrix(ncol=num.of.sims,nrow = 120)

for(j in 1:num.of.sims){
  for(i in 1:90){
    window.start <- i
    window.end <- i + 29
    
    segment <- smoothed.warm.df[c(window.start:window.end),j]
    
    warming.sims.cor.30[i,j] <- acf(segment, plot = FALSE, type = "correlation")[[1]][2]
    warming.sims.cov.30[i,j] <- acf(segment, plot = FALSE, type = "covariance")[[1]][2]
  }
}
```

### Decay Time

```{r}
constant.sims.decay.time.30 <- matrix(ncol = num.of.sims, nrow = 30)
warming.sims.decay.time.30 <- matrix(nco = num.of.sims, nrow = 30)

for(i in 1:num.of.sims){
  for(j in 1:30){
    suppressWarnings(constant.sims.decay.time.30[j, i] <- -j/log(constant.sims.cor.30[j, i]))
    suppressWarnings(warming.sims.decay.time.30[j, i] <- -j/log(warming.sims.cor.30[j, i]))
  }
}
```

# Area Under Curve (AUC) Tests

Function to calculate AUC:

```{r}
calc_auc <- function(test.taus, null.taus){
  
  combined.taus <- c(test.taus, null.taus)
  r <- rank(combined.taus, na.last = NA)
  
  test.taus.length <- sum(!is.na(test.taus))
  null.taus.length <- sum(!is.na(null.taus))
  
  r1 <- sum(r[1:test.taus.length])
  
  n1 <- test.taus.length
  n2 <- null.taus.length
  
  (r1 - n1 * (n1 + 1) / 2) / (n1 * n2)
}
```

Metrics to evaluate:

|                           |                       |
|---------------------------|-----------------------|
| Standard Deviation        | `sd`                  |
| Mean                      | `mean`                |
| Skew                      | `skewness`            |
| Kurtosis                  | `kurtosis`            |
| Variance                  | `variance`            |
| Co-Efficient of Variance  | `cv`                  |
| Index of Dispersion       | `id`                  |
| First Difference Variance | `first.diff.variance` |
| Autocorrelation           | `cor`                 |
| Autocovariance            | `cov`                 |
| Decay Time                | `decay.time`          |

## 5 Day Sliding Window

```{r}
constant.sims.variance.5 <- constant.sims.variance.5[1:55, ]
constant.sims.mean.5 <- constant.sims.mean.5[1:55, ]
constant.sims.cv.5 <- constant.sims.cv.5[1:55, ]
constant.sims.skewness.5 <-  constant.sims.skewness.5[1:55, ]
constant.sims.kurtosis.5 <-  constant.sims.kurtosis.5[1:55, ]
constant.sims.id.5 <-  constant.sims.id.5[1:55, ]
constant.sims.cor.5 <-  constant.sims.cor.5[1:55, ]
constant.sims.cov.5 <-  constant.sims.cov.5[1:55, ]
constant.sims.first.diff.variance.5 <-  constant.sims.first.diff.variance.5[1:55, ]
constant.sims.decay.time.5 <-  constant.sims.decay.time.5[1:55, ]

warming.sims.variance.5 <- warming.sims.variance.5[1:55, ]
warming.sims.mean.5 <- warming.sims.mean.5[1:55, ]
warming.sims.cv.5 <- warming.sims.cv.5[1:55, ]
warming.sims.skewness.5 <-  warming.sims.skewness.5[1:55, ]
warming.sims.kurtosis.5 <-  warming.sims.kurtosis.5[1:55, ]
warming.sims.id.5 <-  warming.sims.id.5[1:55, ]
warming.sims.cor.5 <-  warming.sims.cor.5[1:55, ]
warming.sims.cov.5 <-  warming.sims.cov.5[1:55, ]
warming.sims.first.diff.variance.5 <-  warming.sims.first.diff.variance.5[1:55, ]
warming.sims.decay.time.5 <-  warming.sims.decay.time.5[1:55, ]

constant.sims.variance.5.tau <- c()
constant.sims.mean.5.tau <- c()
constant.sims.cv.5.tau <- c()
constant.sims.skewness.5.tau <-  c()
constant.sims.kurtosis.5.tau <- c()
constant.sims.id.5.tau <- c()
constant.sims.cor.5.tau <- c()
constant.sims.cov.5.tau <- c()
constant.sims.first.diff.variance.5.tau <-  c()
constant.sims.decay.time.5.tau <- c()

warming.sims.variance.5.tau <- c()
warming.sims.mean.5.tau <- c()
warming.sims.cv.5.tau <- c()
warming.sims.skewness.5.tau <-  c()
warming.sims.kurtosis.5.tau <- c()
warming.sims.id.5.tau <-  c()
warming.sims.cor.5.tau <-  c()
warming.sims.cov.5.tau <-  c()
warming.sims.first.diff.variance.5.tau <-  c()
warming.sims.decay.time.5.tau <-  c()
```

Calculate Kendall's tau for each metric:

```{r}
time.5 <- c(1:55)

for(i in 1:num.of.sims){
  constant.sims.mean.5.tau[i] <- cor(constant.sims.mean.5[ , i], time.5, method = "kendall")
  constant.sims.skewness.5.tau[i] <- cor(constant.sims.skewness.5[ , i], time.5, method = "kendall")
  constant.sims.kurtosis.5.tau[i] <- cor(constant.sims.kurtosis.5[ , i], time.5, method = "kendall")
  constant.sims.variance.5.tau[i] <- cor(constant.sims.variance.5[ , i], time.5, method = "kendall")
  constant.sims.cv.5.tau[i] <- cor(constant.sims.cv.5[ , i], time.5, method = "kendall")
  constant.sims.id.5.tau[i] <- cor(constant.sims.id.5[ , i], time.5, method = "kendall")
  constant.sims.first.diff.variance.5.tau[i] <- cor(constant.sims.first.diff.variance.5[ , i], time.5, method = "kendall")
  constant.sims.cor.5.tau[i] <- cor(constant.sims.cor.5[ , i], time.5, method = "kendall")
  constant.sims.cov.5.tau[i] <- cor(constant.sims.cov.5[ , i], time.5, method = "kendall")
  constant.sims.decay.time.5.tau[i] <- cor(constant.sims.decay.time.5[ , i], time.5, method = "kendall")
  
  warming.sims.mean.5.tau[i] <- cor(warming.sims.mean.5[ , i], time.5, method = "kendall")
  warming.sims.skewness.5.tau[i] <- cor(warming.sims.skewness.5[ , i], time.5, method = "kendall")
  warming.sims.kurtosis.5.tau[i] <- cor(warming.sims.kurtosis.5[ , i], time.5, method = "kendall")
  warming.sims.variance.5.tau[i] <- cor(warming.sims.variance.5[ , i], time.5, method = "kendall")
  warming.sims.cv.5.tau[i] <- cor(warming.sims.cv.5[ , i], time.5, method = "kendall")
  warming.sims.id.5.tau[i] <- cor(warming.sims.id.5[ , i], time.5, method = "kendall")
  warming.sims.first.diff.variance.5.tau[i] <- cor(warming.sims.first.diff.variance.5[ , i], time.5, method = "kendall")
  warming.sims.cor.5.tau[i] <- cor(warming.sims.cor.5[ , i], time.5, method = "kendall")
  warming.sims.cov.5.tau[i] <- cor(warming.sims.cov.5[ , i], time.5, method = "kendall")
  warming.sims.decay.time.5.tau[i] <- cor(warming.sims.decay.time.5[ , i], time.5, method = "kendall")
}
```

Calculating AUC:

```{r}
AUC_variance_5 <- calc_auc(warming.sims.variance.5.tau, constant.sims.variance.5.tau); AUC_variance_5
AUC_mean_5 <- calc_auc(warming.sims.mean.5.tau, constant.sims.mean.5.tau); AUC_mean_5
AUC_kurtosis_5 <- calc_auc(warming.sims.kurtosis.5.tau, constant.sims.kurtosis.5.tau); AUC_kurtosis_5
AUC_skewness_5 <- calc_auc(warming.sims.skewness.5.tau, constant.sims.skewness.5.tau); AUC_skewness_5
AUC_id_5 <- calc_auc(warming.sims.id.5.tau, constant.sims.id.5.tau); AUC_id_5
AUC_first.diff.variance_5 <- calc_auc(warming.sims.first.diff.variance.5.tau, constant.sims.first.diff.variance.5.tau); AUC_first.diff.variance_5
AUC_cor_5 <- calc_auc(warming.sims.cor.5.tau, constant.sims.cor.5.tau); AUC_cor_5
AUC_cov_5 <- calc_auc(warming.sims.cov.5.tau, constant.sims.cov.5.tau); AUC_cov_5
AUC_cv_5 <- calc_auc(warming.sims.cv.5.tau, constant.sims.cv.5.tau); AUC_cv_5
AUC_decay.time_5 <- calc_auc(warming.sims.decay.time.5.tau, constant.sims.decay.time.5.tau); AUC_decay.time_5
```

## 15 Day Sliding Window

```{r}
constant.sims.variance.15 <- constant.sims.variance.15[1:45, ]
constant.sims.mean.15 <- constant.sims.mean.15[1:45, ]
constant.sims.cv.15 <- constant.sims.cv.15[1:45, ]
constant.sims.skewness.15 <-  constant.sims.skewness.15[1:45, ]
constant.sims.kurtosis.15 <-  constant.sims.kurtosis.15[1:45, ]
constant.sims.id.15 <-  constant.sims.id.15[1:45, ]
constant.sims.cor.15 <-  constant.sims.cor.15[1:45, ]
constant.sims.cov.15 <-  constant.sims.cov.15[1:45, ]
constant.sims.first.diff.variance.15 <-  constant.sims.first.diff.variance.15[1:45, ]
constant.sims.decay.time.15 <-  constant.sims.decay.time.15[1:45, ]

warming.sims.variance.15 <- warming.sims.variance.15[1:45, ]
warming.sims.mean.15 <- warming.sims.mean.15[1:45, ]
warming.sims.cv.15 <- warming.sims.cv.15[1:45, ]
warming.sims.skewness.15 <-  warming.sims.skewness.15[1:45, ]
warming.sims.kurtosis.15 <-  warming.sims.kurtosis.15[1:45, ]
warming.sims.id.15 <-  warming.sims.id.15[1:45, ]
warming.sims.cor.15 <-  warming.sims.cor.15[1:45, ]
warming.sims.cov.15 <-  warming.sims.cov.15[1:45, ]
warming.sims.first.diff.variance.15 <-  warming.sims.first.diff.variance.15[1:45, ]
warming.sims.decay.time.15 <-  warming.sims.decay.time.15[1:45, ]

constant.sims.variance.15.tau <- c()
constant.sims.mean.15.tau <- c()
constant.sims.cv.15.tau <- c()
constant.sims.skewness.15.tau <-  c()
constant.sims.kurtosis.15.tau <- c()
constant.sims.id.15.tau <- c()
constant.sims.cor.15.tau <- c()
constant.sims.cov.15.tau <- c()
constant.sims.first.diff.variance.15.tau <-  c()
constant.sims.decay.time.15.tau <- c()

warming.sims.variance.15.tau <- c()
warming.sims.mean.15.tau <- c()
warming.sims.cv.15.tau <- c()
warming.sims.skewness.15.tau <-  c()
warming.sims.kurtosis.15.tau <- c()
warming.sims.id.15.tau <-  c()
warming.sims.cor.15.tau <-  c()
warming.sims.cov.15.tau <-  c()
warming.sims.first.diff.variance.15.tau <-  c()
warming.sims.decay.time.15.tau <-  c()
```

Calculate Kendall's tau for each metric:

```{r}
time.15 <- c(1:45)

for(i in 1:num.of.sims){
  constant.sims.mean.15.tau[i] <- cor(constant.sims.mean.15[ , i], time.15, method = "kendall")
  constant.sims.skewness.15.tau[i] <- cor(constant.sims.skewness.15[ , i], time.15, method = "kendall")
  constant.sims.kurtosis.15.tau[i] <- cor(constant.sims.kurtosis.15[ , i], time.15, method = "kendall")
  constant.sims.variance.15.tau[i] <- cor(constant.sims.variance.15[ , i], time.15, method = "kendall")
  constant.sims.cv.15.tau[i] <- cor(constant.sims.cv.15[ , i], time.15, method = "kendall")
  constant.sims.id.15.tau[i] <- cor(constant.sims.id.15[ , i], time.15, method = "kendall")
  constant.sims.first.diff.variance.15.tau[i] <- cor(constant.sims.first.diff.variance.15[ , i], time.15, method = "kendall")
  constant.sims.cor.15.tau[i] <- cor(constant.sims.cor.15[ , i], time.15, method = "kendall")
  constant.sims.cov.15.tau[i] <- cor(constant.sims.cov.15[ , i], time.15, method = "kendall")
  constant.sims.decay.time.15.tau[i] <- cor(constant.sims.decay.time.15[ , i], time.15, method = "kendall")
  
  warming.sims.mean.15.tau[i] <- cor(warming.sims.mean.15[ , i], time.15, method = "kendall")
  warming.sims.skewness.15.tau[i] <- cor(warming.sims.skewness.15[ , i], time.15, method = "kendall")
  warming.sims.kurtosis.15.tau[i] <- cor(warming.sims.kurtosis.15[ , i], time.15, method = "kendall")
  warming.sims.variance.15.tau[i] <- cor(warming.sims.variance.15[ , i], time.15, method = "kendall")
  warming.sims.cv.15.tau[i] <- cor(warming.sims.cv.15[ , i], time.15, method = "kendall")
  warming.sims.id.15.tau[i] <- cor(warming.sims.id.15[ , i], time.15, method = "kendall")
  warming.sims.first.diff.variance.15.tau[i] <- cor(warming.sims.first.diff.variance.15[ , i], time.15, method = "kendall")
  warming.sims.cor.15.tau[i] <- cor(warming.sims.cor.15[ , i], time.15, method = "kendall")
  warming.sims.cov.15.tau[i] <- cor(warming.sims.cov.15[ , i], time.15, method = "kendall")
  warming.sims.decay.time.15.tau[i] <- cor(warming.sims.decay.time.15[ , i], time.15, method = "kendall")
}
```

Calculating AUC:

```{r}
AUC_variance_15 <- calc_auc(warming.sims.variance.15.tau, constant.sims.variance.15.tau); AUC_variance_15
AUC_mean_15 <- calc_auc(warming.sims.mean.15.tau, constant.sims.mean.15.tau); AUC_mean_15
AUC_kurtosis_15 <- calc_auc(warming.sims.kurtosis.15.tau, constant.sims.kurtosis.15.tau); AUC_kurtosis_15
AUC_skewness_15 <- calc_auc(warming.sims.skewness.15.tau, constant.sims.skewness.15.tau); AUC_skewness_15
AUC_id_15 <- calc_auc(warming.sims.id.15.tau, constant.sims.id.15.tau); AUC_id_15
AUC_first.diff.variance_15 <- calc_auc(warming.sims.first.diff.variance.15.tau, constant.sims.first.diff.variance.15.tau); AUC_first.diff.variance_15
AUC_cor_15 <- calc_auc(warming.sims.cor.15.tau, constant.sims.cor.15.tau); AUC_cor_15
AUC_cov_15 <- calc_auc(warming.sims.cov.15.tau, constant.sims.cov.15.tau); AUC_cov_15
AUC_cv_15 <- calc_auc(warming.sims.cv.15.tau, constant.sims.cv.15.tau); AUC_cv_15
AUC_decay.time_15 <- calc_auc(warming.sims.decay.time.15.tau, constant.sims.decay.time.15.tau); AUC_decay.time_15
```

## 30 Day Sliding Window

```{r}
constant.sims.variance.30 <- constant.sims.variance.30[1:30, ]
constant.sims.mean.30 <- constant.sims.mean.30[1:30, ]
constant.sims.cv.30 <- constant.sims.cv.30[1:30, ]
constant.sims.skewness.30 <-  constant.sims.skewness.30[1:30, ]
constant.sims.kurtosis.30 <-  constant.sims.kurtosis.30[1:30, ]
constant.sims.id.30 <-  constant.sims.id.30[1:30, ]
constant.sims.cor.30 <-  constant.sims.cor.30[1:30, ]
constant.sims.cov.30 <-  constant.sims.cov.30[1:30, ]
constant.sims.first.diff.variance.30 <-  constant.sims.first.diff.variance.30[1:30, ]
constant.sims.decay.time.30 <-  constant.sims.decay.time.30[1:30, ]

warming.sims.variance.30 <- warming.sims.variance.30[1:30, ]
warming.sims.mean.30 <- warming.sims.mean.30[1:30, ]
warming.sims.cv.30 <- warming.sims.cv.30[1:30, ]
warming.sims.skewness.30 <-  warming.sims.skewness.30[1:30, ]
warming.sims.kurtosis.30 <-  warming.sims.kurtosis.30[1:30, ]
warming.sims.id.30 <-  warming.sims.id.30[1:30, ]
warming.sims.cor.30 <-  warming.sims.cor.30[1:30, ]
warming.sims.cov.30 <-  warming.sims.cov.30[1:30, ]
warming.sims.first.diff.variance.30 <-  warming.sims.first.diff.variance.30[1:30, ]
warming.sims.decay.time.30 <-  warming.sims.decay.time.30[1:30, ]

constant.sims.variance.30.tau <- c()
constant.sims.mean.30.tau <- c()
constant.sims.cv.30.tau <- c()
constant.sims.skewness.30.tau <-  c()
constant.sims.kurtosis.30.tau <- c()
constant.sims.id.30.tau <- c()
constant.sims.cor.30.tau <- c()
constant.sims.cov.30.tau <- c()
constant.sims.first.diff.variance.30.tau <-  c()
constant.sims.decay.time.30.tau <- c()

warming.sims.variance.30.tau <- c()
warming.sims.mean.30.tau <- c()
warming.sims.cv.30.tau <- c()
warming.sims.skewness.30.tau <-  c()
warming.sims.kurtosis.30.tau <- c()
warming.sims.id.30.tau <-  c()
warming.sims.cor.30.tau <-  c()
warming.sims.cov.30.tau <-  c()
warming.sims.first.diff.variance.30.tau <-  c()
warming.sims.decay.time.30.tau <-  c()
```

Calculate Kendall's tau for each metric:

```{r}
time.30 <- c(1:30)

for(i in 1:num.of.sims){
  constant.sims.mean.30.tau[i] <- cor(constant.sims.mean.30[ , i], time.30, method = "kendall")
  constant.sims.skewness.30.tau[i] <- cor(constant.sims.skewness.30[ , i], time.30, method = "kendall")
  constant.sims.kurtosis.30.tau[i] <- cor(constant.sims.kurtosis.30[ , i], time.30, method = "kendall")
  constant.sims.variance.30.tau[i] <- cor(constant.sims.variance.30[ , i], time.30, method = "kendall")
  constant.sims.cv.30.tau[i] <- cor(constant.sims.cv.30[ , i], time.30, method = "kendall")
  constant.sims.id.30.tau[i] <- cor(constant.sims.id.30[ , i], time.30, method = "kendall")
  constant.sims.first.diff.variance.30.tau[i] <- cor(constant.sims.first.diff.variance.30[ , i], time.30, method = "kendall")
  constant.sims.cor.30.tau[i] <- cor(constant.sims.cor.30[ , i], time.30, method = "kendall")
  constant.sims.cov.30.tau[i] <- cor(constant.sims.cov.30[ , i], time.30, method = "kendall")
  constant.sims.decay.time.30.tau[i] <- cor(constant.sims.decay.time.30[ , i], time.30, method = "kendall")
  
  warming.sims.mean.30.tau[i] <- cor(warming.sims.mean.30[ , i], time.30, method = "kendall")
  warming.sims.skewness.30.tau[i] <- cor(warming.sims.skewness.30[ , i], time.30, method = "kendall")
  warming.sims.kurtosis.30.tau[i] <- cor(warming.sims.kurtosis.30[ , i], time.30, method = "kendall")
  warming.sims.variance.30.tau[i] <- cor(warming.sims.variance.30[ , i], time.30, method = "kendall")
  warming.sims.cv.30.tau[i] <- cor(warming.sims.cv.30[ , i], time.30, method = "kendall")
  warming.sims.id.30.tau[i] <- cor(warming.sims.id.30[ , i], time.30, method = "kendall")
  warming.sims.first.diff.variance.30.tau[i] <- cor(warming.sims.first.diff.variance.30[ , i], time.30, method = "kendall")
  warming.sims.cor.30.tau[i] <- cor(warming.sims.cor.30[ , i], time.30, method = "kendall")
  warming.sims.cov.30.tau[i] <- cor(warming.sims.cov.30[ , i], time.30, method = "kendall")
  warming.sims.decay.time.30.tau[i] <- cor(warming.sims.decay.time.30[ , i], time.30, method = "kendall")
}
```

Calculating AUC:

```{r}
AUC_variance_30 <- calc_auc(warming.sims.variance.30.tau, constant.sims.variance.30.tau); AUC_variance_30
AUC_mean_30 <- calc_auc(warming.sims.mean.30.tau, constant.sims.mean.30.tau); AUC_mean_30
AUC_kurtosis_30 <- calc_auc(warming.sims.kurtosis.30.tau, constant.sims.kurtosis.30.tau); AUC_kurtosis_30
AUC_skewness_30 <- calc_auc(warming.sims.skewness.30.tau, constant.sims.skewness.30.tau); AUC_skewness_30
AUC_id_30 <- calc_auc(warming.sims.id.30.tau, constant.sims.id.30.tau); AUC_id_30
AUC_first.diff.variance_30 <- calc_auc(warming.sims.first.diff.variance.30.tau, constant.sims.first.diff.variance.30.tau); AUC_first.diff.variance_30
AUC_cor_30 <- calc_auc(warming.sims.cor.30.tau, constant.sims.cor.30.tau); AUC_cor_30
AUC_cov_30 <- calc_auc(warming.sims.cov.30.tau, constant.sims.cov.30.tau); AUC_cov_30
AUC_cv_30 <- calc_auc(warming.sims.cv.30.tau, constant.sims.cv.30.tau); AUC_cv_30
AUC_decay.time_30 <- calc_auc(warming.sims.decay.time.30.tau, constant.sims.decay.time.30.tau); AUC_decay.time_30
```

## Summarize Outputs

```{r}
metrics <- c("mean", "skewness", "kurtosis", "variance", "cv", "id", "first.diff.variance", "cor", "cov", "decay.time")

AUC_5 <- c(AUC_mean_5, AUC_skewness_5, AUC_kurtosis_5, AUC_variance_5, AUC_cv_5, 
           AUC_id_5, AUC_first.diff.variance_5, AUC_cor_5 ,AUC_cov_5, AUC_decay.time_5)
AUC_15 <- c(AUC_mean_15, AUC_skewness_15, AUC_kurtosis_15, AUC_variance_15, AUC_cv_15, 
           AUC_id_15, AUC_first.diff.variance_15, AUC_cor_15 ,AUC_cov_15, AUC_decay.time_15)
AUC_30 <- c(AUC_mean_30, AUC_skewness_30, AUC_kurtosis_30, AUC_variance_30, AUC_cv_30, 
           AUC_id_30, AUC_first.diff.variance_30, AUC_cor_30 ,AUC_cov_30, AUC_decay.time_30)
AUC_df <- data.frame(metrics, AUC_5, AUC_15, AUC_30); AUC_df
saveRDS(AUC_df, "Objects/AUC_SmoothedSimulatedData.rds")
```

A quick plot!

```{r}
metrics_full <- c("Mean", "Skewness", "Kurtosis", "Variance", "Covariance", "Index of Dispersion", "First Difference Variance", "Autocorrelation", "Autocovariance", "Decay Time")

## Plot 
plot(1:10, AUC_df$AUC_5, type = "p", 
     main = "Smoothed Simulated Data", xaxt = "none", xlab = "", ylim = c(0.3, 0.7), ylab = "AUC",
     col = "forestgreen", pch = 19)
points(1:10, AUC_df$AUC_15, col = "orchid", pch = 19)
points(1:10, AUC_df$AUC_30, col = "#4B0082", pch = 19)
abline(h = 0.5, lty = 3)
axis(side = 1, at = 1:10, labels = metrics_full, las = 2)
legend("bottomright", 
       legend = c("Sliding Window = 5 Days", "Sliding Window = 15 Days", "Sliding Window = 30 Days"),
       col = c("forestgreen", "orchid", "#4B0082"), pch = 19)

## Saving plot as .png
png(file = "Plots/AUC_SmoothedSimulatedData.png", width = 1500, height = 350)
plot(1:10, AUC_df$AUC_5, type = "p", 
     main = "Smoothed Simulated Data", xaxt = "none", xlab = "", ylim = c(0.3, 0.7), ylab = "AUC",
     col = "forestgreen", pch = 19)
points(1:10, AUC_df$AUC_15, col = "orchid", pch = 19)
points(1:10, AUC_df$AUC_30, col = "#4B0082", pch = 19)
abline(h = 0.5, lty = 3)
axis(side = 1, at = 1:10, labels = metrics_full)
legend("bottomright", 
       legend = c("Sliding Window = 5 Days", "Sliding Window = 15 Days", "Sliding Window = 30 Days"),
       col = c("forestgreen", "orchid", "#4B0082"), pch = 19)
dev.off()
```

# Empirical Data

The object containing the smoothed empirical data is inaptly named `df`, so go to `5_Detrending.Rmd` to regenerate it, or just use the code below.

```{r}
data <- read.csv("Kirk_Data/Epidemics_Data_Dryad/Kirk_et_al_epidemics_sampling_data.csv")
data.sum <- summaryBy(status ~ population + treatment + day, data = data, FUN = sum)
sub1 <- subset(data.sum, population == 1) 
sub1 <- cbind(sub1$day, sub1$status.sum); colnames(sub1) <- c("day", "infecteds")
sub2 <- subset(data.sum, population == 2) 
sub2 <- cbind(sub2$day, sub2$status.sum); colnames(sub2) <- c("day", "infecteds")
sub3 <- subset(data.sum, population == 3) 
sub3 <- cbind(sub3$day, sub3$status.sum); colnames(sub3) <- c("day", "infecteds")
sub4 <- subset(data.sum, population == 4) 
sub4 <- cbind(sub4$day, sub4$status.sum); colnames(sub4) <- c("day", "infecteds")
sub5 <- subset(data.sum, population == 5) 
sub5 <- cbind(sub5$day, sub5$status.sum); colnames(sub5) <- c("day", "infecteds")
sub6 <- subset(data.sum, population == 6) 
sub6 <- cbind(sub6$day, sub6$status.sum); colnames(sub6) <- c("day", "infecteds")
sub7 <- subset(data.sum, population == 7) 
sub7 <- cbind(sub7$day, sub7$status.sum); colnames(sub7) <- c("day", "infecteds")
sub8 <- subset(data.sum, population == 8) 
sub8 <- cbind(sub8$day, sub8$status.sum); colnames(sub8) <- c("day", "infecteds")

subpops.list <- list(sub1, sub2, sub3, sub4, sub5, sub6, sub7, sub8)

interval <- 3
day.nums <- seq(0, sub1[ , 1][length(sub1[ , 1])] - interval, 3)
suppressWarnings(
for (i in sub1[ , 1][1:39]){
  temp <- c(seq(-i, -interval, interval), 0, seq(interval, sub1[ , 1][length(sub1[ , 1])] - interval*2, interval))
  day.nums <- cbind(day.nums, temp)
})

width <- 3; subpops <- seq(1, 8, 1); df <- matrix(nrow = nrow(sub1), ncol = length(widths))
for (j in subpops){
  temp <- c(); smoothed <- c()
  for (i in 1:nrow(sub1)){
    temp <- exp(-(day.nums[ , i]^2) / (2*(width^2)))
    temp <- temp/sum(temp)
    smoothed[i] <- sum(subpops.list[[j]][ , 2]*temp)
  }
  df[ , j] <- smoothed
}

smoothed.emp.data <- data.frame(df); colnames(smoothed.emp.data) <- c("sub1", "sub2", "sub3", "sub4",
                                                          "sub5", "sub6", "sub7", "sub8")
```

# Calculating Statistical Metrics Along Variously-Sized Sliding Windows

## 15 Day Sliding Window

### Standard Deviation, Mean, Skewness, Kurtosis

```{r}
## Standard deviation
pop1.sd <- SlidingWindow(FUN = "sd", data = smoothed.emp.data$sub1, window = 5, step = 1)
pop2.sd <- SlidingWindow(FUN = "sd", data = smoothed.emp.data$sub2, window = 5, step = 1)
pop3.sd <- SlidingWindow(FUN = "sd", data = smoothed.emp.data$sub3, window = 5, step = 1)
pop4.sd <- SlidingWindow(FUN = "sd", data = smoothed.emp.data$sub4, window = 5, step = 1)
pop5.sd <- SlidingWindow(FUN = "sd", data = smoothed.emp.data$sub5, window = 5, step = 1)
pop6.sd <- SlidingWindow(FUN = "sd", data = smoothed.emp.data$sub6, window = 5, step = 1)
pop7.sd <- SlidingWindow(FUN = "sd", data = smoothed.emp.data$sub7, window = 5, step = 1)
pop8.sd <- SlidingWindow(FUN = "sd", data = smoothed.emp.data$sub8, window = 5, step = 1)

## Mean
pop1.mean <- SlidingWindow(FUN = "mean", data = smoothed.emp.data$sub1, window = 5, step = 1)
pop2.mean <- SlidingWindow(FUN = "mean", data = smoothed.emp.data$sub2, window = 5, step = 1)
pop3.mean <- SlidingWindow(FUN = "mean", data = smoothed.emp.data$sub3, window = 5, step = 1)
pop4.mean <- SlidingWindow(FUN = "mean", data = smoothed.emp.data$sub4, window = 5, step = 1)
pop5.mean <- SlidingWindow(FUN = "mean", data = smoothed.emp.data$sub5, window = 5, step = 1)
pop6.mean <- SlidingWindow(FUN = "mean", data = smoothed.emp.data$sub6, window = 5, step = 1)
pop7.mean <- SlidingWindow(FUN = "mean", data = smoothed.emp.data$sub7, window = 5, step = 1)
pop8.mean <- SlidingWindow(FUN = "mean", data = smoothed.emp.data$sub8, window = 5, step = 1)

## Skewness
pop1.skewness <- SlidingWindow(FUN = "skewness", data = smoothed.emp.data$sub1, window = 5, step = 1)
pop2.skewness <- SlidingWindow(FUN = "skewness", data = smoothed.emp.data$sub2, window = 5, step = 1)
pop3.skewness <- SlidingWindow(FUN = "skewness", data = smoothed.emp.data$sub3, window = 5, step = 1)
pop4.skewness <- SlidingWindow(FUN = "skewness", data = smoothed.emp.data$sub4, window = 5, step = 1)
pop5.skewness <- SlidingWindow(FUN = "skewness", data = smoothed.emp.data$sub5, window = 5, step = 1)
pop6.skewness <- SlidingWindow(FUN = "skewness", data = smoothed.emp.data$sub6, window = 5, step = 1)
pop7.skewness <- SlidingWindow(FUN = "skewness", data = smoothed.emp.data$sub7, window = 5, step = 1)
pop8.skewness <- SlidingWindow(FUN = "skewness", data = smoothed.emp.data$sub8, window = 5, step = 1)

## Kurtosis
pop1.kurtosis <- SlidingWindow(FUN = "kurtosis", data = smoothed.emp.data$sub1, window = 5, step = 1)
pop2.kurtosis <- SlidingWindow(FUN = "kurtosis", data = smoothed.emp.data$sub2, window = 5, step = 1)
pop3.kurtosis <- SlidingWindow(FUN = "kurtosis", data = smoothed.emp.data$sub3, window = 5, step = 1)
pop4.kurtosis <- SlidingWindow(FUN = "kurtosis", data = smoothed.emp.data$sub4, window = 5, step = 1)
pop5.kurtosis <- SlidingWindow(FUN = "kurtosis", data = smoothed.emp.data$sub5, window = 5, step = 1)
pop6.kurtosis <- SlidingWindow(FUN = "kurtosis", data = smoothed.emp.data$sub6, window = 5, step = 1)
pop7.kurtosis <- SlidingWindow(FUN = "kurtosis", data = smoothed.emp.data$sub7, window = 5, step = 1)
pop8.kurtosis <- SlidingWindow(FUN = "kurtosis", data = smoothed.emp.data$sub8, window = 5, step = 1)
```

### Variation

```{r}
pop1.var <- pop1.sd^2
pop2.var <- pop2.sd^2
pop3.var <- pop3.sd^2
pop4.var <- pop4.sd^2
pop5.var <- pop5.sd^2
pop6.var <- pop6.sd^2
pop7.var <- pop7.sd^2
pop8.var <- pop8.sd^2
```

### Co-Efficient of Variation

```{r}
pop1.cv <- pop1.sd/(pop1.mean + 1e-10)
pop2.cv <- pop2.sd/(pop2.mean + 1e-10)
pop3.cv <- pop3.sd/(pop3.mean + 1e-10)
pop4.cv <- pop4.sd/(pop4.mean + 1e-10)
pop5.cv <- pop5.sd/(pop5.mean + 1e-10)
pop6.cv <- pop6.sd/(pop6.mean + 1e-10)
pop7.cv <- pop7.sd/(pop7.mean + 1e-10)
pop8.cv <- pop8.sd/(pop8.mean + 1e-10)
```

### Index of Dispersion

```{r}
pop1.id <- pop1.var/(pop1.mean + 1e-10)
pop2.id <- pop2.var/(pop2.mean + 1e-10)
pop3.id <- pop3.var/(pop3.mean + 1e-10)
pop4.id <- pop4.var/(pop4.mean + 1e-10)
pop5.id <- pop5.var/(pop5.mean + 1e-10)
pop6.id <- pop6.var/(pop6.mean + 1e-10)
pop7.id <- pop7.var/(pop7.mean + 1e-10)
pop8.id <- pop8.var/(pop8.mean + 1e-10)
```

### First Difference Variance

```{r}
pop1.first.diff.variance <- c()
pop2.first.diff.variance <- c()
pop3.first.diff.variance <- c()
pop4.first.diff.variance <- c()
pop5.first.diff.variance <- c()
pop6.first.diff.variance <- c()
pop7.first.diff.variance <- c()
pop8.first.diff.variance <- c()

for(i in 2:35){
pop1.first.diff.variance[i - 1] <- pop1.var[i] - pop1.var[i - 1]
pop2.first.diff.variance[i - 1] <- pop2.var[i] - pop2.var[i - 1]
pop3.first.diff.variance[i - 1] <- pop3.var[i] - pop3.var[i - 1]
pop4.first.diff.variance[i - 1] <- pop4.var[i] - pop4.var[i - 1]
pop5.first.diff.variance[i - 1] <- pop5.var[i] - pop5.var[i - 1]
pop6.first.diff.variance[i - 1] <- pop6.var[i] - pop6.var[i - 1]
pop7.first.diff.variance[i - 1] <- pop7.var[i] - pop7.var[i - 1]
pop8.first.diff.variance[i - 1] <- pop8.var[i] - pop8.var[i - 1]
}
```

### Autocorrelation and Autocovariance

```{r}
pop1.ac <- c()
pop1.cov <- c()
for(i in 1:35){
  window.start <- i
  window.end <- i + 4
  
  segment <- smoothed.emp.data$sub1[c(window.start:window.end)]
  
  pop1.ac[i] <- acf(segment, plot = FALSE, type = "correlation")[[1]][2]
  pop1.cov[i] <- acf(segment, plot = FALSE, type = "covariance")[[1]][2]
}

pop2.ac <- c()
pop2.cov <- c()
for(i in 1:35){
  window.start <- i
  window.end <- i + 4
  
  segment <- smoothed.emp.data$sub2[c(window.start:window.end)]
  
  pop2.ac[i] <- acf(segment, plot = FALSE, type = "correlation")[[1]][2]
  pop2.cov[i] <- acf(segment, plot = FALSE, type = "covariance")[[1]][2]
}

pop3.ac <- c()
pop3.cov <- c()
for(i in 1:35){
  window.start <- i
  window.end <- i + 4
  
  segment <- smoothed.emp.data$sub3[c(window.start:window.end)]
  
  pop3.ac[i] <- acf(segment, plot = FALSE, type = "correlation")[[1]][2]
  pop3.cov[i] <- acf(segment, plot = FALSE, type = "covariance")[[1]][2]
}


pop4.ac <- c()
pop4.cov <- c()
for(i in 1:35){
  window.start <- i
  window.end <- i + 4
  
  segment <- smoothed.emp.data$sub4[c(window.start:window.end)]
  
  pop4.ac[i] <- acf(segment, plot = FALSE, type = "correlation")[[1]][2]
  pop4.cov[i] <- acf(segment, plot = FALSE, type = "covariance")[[1]][2]
}

pop5.ac <- c()
pop5.cov <- c()
for(i in 1:35){
  window.start <- i
  window.end <- i + 4
  
  segment <- smoothed.emp.data$sub5[c(window.start:window.end)]
  
  pop5.ac[i] <- acf(segment, plot = FALSE, type = "correlation")[[1]][2]
  pop5.cov[i] <- acf(segment, plot = FALSE, type = "covariance")[[1]][2]
}

pop6.ac <- c()
pop6.cov <- c()
for(i in 1:35){
  window.start <- i
  window.end <- i + 4
  
  segment <- smoothed.emp.data$sub6[c(window.start:window.end)]
  
  pop6.ac[i] <- acf(segment, plot = FALSE, type = "correlation")[[1]][2]
  pop6.cov[i] <- acf(segment, plot = FALSE, type = "covariance")[[1]][2]
}


pop7.ac <- c()
pop7.cov <- c()
for(i in 1:35){
  window.start <- i
  window.end <- i + 4
  
  segment <- smoothed.emp.data$sub7[c(window.start:window.end)]
  
  pop7.ac[i] <- acf(segment, plot = FALSE, type = "correlation")[[1]][2]
  pop7.cov[i] <- acf(segment, plot = FALSE, type = "covariance")[[1]][2]
}

pop8.ac <- c()
pop8.cov <- c()
for(i in 1:35){
  window.start <- i
  window.end <- i + 4
  
  segment <- smoothed.emp.data$sub8[c(window.start:window.end)]
  
  pop8.ac[i] <- acf(segment, plot = FALSE, type = "correlation")[[1]][2]
  pop8.cov[i] <- acf(segment, plot = FALSE, type = "covariance")[[1]][2]
}
```

### Decay Time

```{r}
pop1.decay.time <- c()
pop2.decay.time <- c()
pop3.decay.time <- c()
pop4.decay.time <- c()
pop5.decay.time <- c()
pop6.decay.time <- c()
pop7.decay.time <- c()
pop8.decay.time <- c()

for(i in 1:35){
  suppressWarnings(pop1.decay.time[i] <- -i/log(pop1.ac[i]))
  suppressWarnings(pop2.decay.time[i] <- -i/log(pop2.ac[i]))
  suppressWarnings(pop3.decay.time[i] <- -i/log(pop3.ac[i]))
  suppressWarnings(pop4.decay.time[i] <- -i/log(pop4.ac[i]))
  suppressWarnings(pop5.decay.time[i] <- -i/log(pop5.ac[i]))
  suppressWarnings(pop6.decay.time[i] <- -i/log(pop6.ac[i]))
  suppressWarnings(pop7.decay.time[i] <- -i/log(pop7.ac[i]))
  suppressWarnings(pop8.decay.time[i] <- -i/log(pop8.ac[i]))
}
```

# Area Under Curve (AUC) Tests

## 15 Day Sliding Window

Calculate Kendall's tau for each metric:

```{r}
time.15 <- seq(1, 15, 1)

constant.mean.tau<- c(cor(pop1.mean[1:15], time.15, method = "kendall"), cor(pop2.mean[1:15], time.15, method = "kendall"),
                      cor(pop3.mean[1:15], time.15, method = "kendall"), cor(pop4.mean[1:15], time.15, method = "kendall"))
warming.mean.tau <- c(cor(pop5.mean[1:15], time.15, method = "kendall"), cor(pop6.mean[1:15], time.15, method = "kendall"),
                      cor(pop7.mean[1:15], time.15, method = "kendall"), cor(pop8.mean[1:15], time.15, method = "kendall"))

constant.skewness.tau<- c(cor(pop1.skewness[1:15], time.15, method = "kendall"), cor(pop2.skewness[1:15], time.15, method = "kendall"),
                          cor(pop3.skewness[1:15], time.15, method = "kendall"), cor(pop4.skewness[1:15], time.15, method = "kendall"))
warming.skewness.tau <- c(cor(pop5.skewness[1:15], time.15, method = "kendall"), cor(pop6.skewness[1:15], time.15, method = "kendall"),
                          cor(pop7.skewness[1:15], time.15, method = "kendall"), cor(pop8.skewness[1:15], time.15, method = "kendall"))

constant.kurtosis.tau<- c(cor(pop1.kurtosis[1:15], time.15, method = "kendall"), cor(pop2.kurtosis[1:15], time.15, method = "kendall"),
                          cor(pop3.kurtosis[1:15], time.15, method = "kendall"), cor(pop4.kurtosis[1:15], time.15, method = "kendall"))
warming.kurtosis.tau <- c(cor(pop5.kurtosis[1:15], time.15, method = "kendall"), cor(pop6.kurtosis[1:15], time.15, method = "kendall"),
                          cor(pop7.kurtosis[1:15], time.15, method = "kendall"), cor(pop8.kurtosis[1:15], time.15, method = "kendall"))

constant.variance.tau<- c(cor(pop1.var[1:15], time.15, method = "kendall"), cor(pop2.var[1:15], time.15, method = "kendall"),
                          cor(pop3.var[1:15], time.15, method = "kendall"), cor(pop4.var[1:15], time.15, method = "kendall"))
warming.variance.tau<- c(cor(pop5.var[1:15], time.15, method = "kendall"), cor(pop6.var[1:15], time.15, method = "kendall"),
                         cor(pop7.var[1:15], time.15, method = "kendall"), cor(pop8.var[1:15], time.15, method = "kendall"))

constant.cv.tau<- c(cor(pop1.cv[1:15], time.15, method = "kendall"), cor(pop2.cv[1:15], time.15, method = "kendall"),
                    cor(pop3.cv[1:15], time.15, method = "kendall"), cor(pop4.cv[1:15], time.15, method = "kendall"))
warming.cv.tau <- c(cor(pop5.cv[1:15], time.15, method = "kendall"), cor(pop6.cv[1:15], time.15, method = "kendall"),
                    cor(pop7.cv[1:15], time.15, method = "kendall"), cor(pop8.cv[1:15], time.15, method = "kendall"))

constant.id.tau<- c(cor(pop1.id[1:15], time.15, method = "kendall"), cor(pop2.id[1:15], time.15, method = "kendall"),
                    cor(pop3.id[1:15], time.15, method = "kendall"), cor(pop4.id[1:15], time.15, method = "kendall"))
warming.id.tau <- c(cor(pop5.id[1:15], time.15, method = "kendall"), cor(pop6.id[1:15], time.15, method = "kendall"),
                    cor(pop7.id[1:15], time.15, method = "kendall"), cor(pop8.id[1:15], time.15, method = "kendall"))

constant.first.diff.variance.tau<- c(cor(pop1.first.diff.variance[1:15], time.15, method = "kendall"), cor(pop2.first.diff.variance[1:15], time.15, method = "kendall"),
                                     cor(pop3.first.diff.variance[1:15], time.15, method = "kendall"), cor(pop4.first.diff.variance[1:15], time.15, method = "kendall"))
warming.first.diff.variance.tau <- c(cor(pop5.first.diff.variance[1:15], time.15, method = "kendall"), cor(pop6.first.diff.variance[1:15], time.15, method = "kendall"),
                                     cor(pop7.first.diff.variance[1:15], time.15, method = "kendall"), cor(pop8.first.diff.variance[1:15], time.15, method = "kendall"))

constant.ac.tau<- c(cor(pop1.ac[1:15], time.15, method = "kendall"), cor(pop2.ac[1:15], time.15, method = "kendall"),
                    cor(pop3.ac[1:15], time.15, method = "kendall"), cor(pop4.ac[1:15], time.15, method = "kendall"))
warming.ac.tau <- c(cor(pop5.ac[1:15], time.15, method = "kendall"), cor(pop6.ac[1:15], time.15, method = "kendall"),
                    cor(pop7.ac[1:15], time.15, method = "kendall"), cor(pop8.ac[1:15], time.15, method = "kendall"))

constant.cov.tau<- c(cor(pop1.cov[1:15], time.15, method = "kendall"), cor(pop2.cov[1:15], time.15, method = "kendall"),
                     cor(pop3.cov[1:15], time.15, method = "kendall"), cor(pop4.cov[1:15], time.15, method = "kendall"))
warming.cov.tau <- c(cor(pop5.cov[1:15], time.15, method = "kendall"), cor(pop6.cov[1:15], time.15, method = "kendall"),
                     cor(pop7.cov[1:15], time.15, method = "kendall"), cor(pop8.cov[1:15], time.15, method = "kendall"))

constant.decay.time.tau<- c(cor(pop1.decay.time[1:15], time.15, method = "kendall"), cor(pop2.decay.time[1:15], time.15, method = "kendall"),
                            cor(pop3.decay.time[1:15], time.15, method = "kendall"), cor(pop4.decay.time[1:15], time.15, method = "kendall"))
warming.decay.time.tau <- c(cor(pop5.decay.time[1:15], time.15, method = "kendall"), cor(pop6.decay.time[1:15], time.15, method = "kendall"),
                            cor(pop7.decay.time[1:15], time.15, method = "kendall"), cor(pop8.decay.time[1:15], time.15, method = "kendall"))
```

Calculating AUC:

```{r}
AUC_mean_data <- calc_auc(warming.mean.tau,constant.mean.tau) ; AUC_mean_data
AUC_skewness_data <- calc_auc(warming.skewness.tau,constant.skewness.tau) ; AUC_skewness_data
AUC_kurtosis_data <- calc_auc(warming.kurtosis.tau,constant.kurtosis.tau) ; AUC_kurtosis_data
AUC_variance_data <- calc_auc(warming.variance.tau,constant.variance.tau) ; AUC_variance_data
AUC_cv_data <- calc_auc(warming.cv.tau,constant.cv.tau) ; AUC_cv_data
AUC_id_data <- calc_auc(warming.id.tau,constant.id.tau) ; AUC_id_data
AUC_first.diff.variance_data <- calc_auc(warming.first.diff.variance.tau,constant.first.diff.variance.tau) ; AUC_first.diff.variance_data
AUC_ac_data <- calc_auc(warming.ac.tau,constant.ac.tau) ; AUC_ac_data
AUC_cov_data <- calc_auc(warming.cov.tau,constant.cov.tau) ; AUC_cov_data
AUC_decay.time_data <- calc_auc(warming.decay.time.tau,constant.decay.time.tau) ; AUC_decay.time_data
```

## Summarize Outputs

```{r}
metrics <- c("mean", "skewness", "kurtosis", "variance", "cv", "id", "first.diff.variance", "ac", "cov", "decay.time")

AUC_data <- c(AUC_mean_data, 
              AUC_skewness_data, 
              AUC_kurtosis_data, 
              AUC_variance_data,
              AUC_cv_data,
              AUC_id_data, 
              AUC_first.diff.variance_data, 
              AUC_ac_data, 
              AUC_cov_data, 
              AUC_decay.time_data)

AUC_df <- data.frame(metrics, AUC_data); AUC_df
saveRDS(AUC_df, "Objects/AUC_SmoothedEmpiricalData.rds")
```

A plot!

```{r}
metrics_full <- c("Mean", "Skewness", "Kurtosis", "Variance", "Covariance", "Index of Dispersion", "First Difference Variance", "Autocorrelation", "Autocovariance", "Decay Time")

## Plot
plot(1:10, AUC_df$AUC_data, type = "p", 
     main = "Smoothed Empirical Data, All Populations", xaxt = "none", xlab = "", ylim = c(0, 1), ylab = "AUC",
     col = "orchid", pch = 19)
abline(h = 0.5, lty = 3)
axis(side = 1, at = 1:10, labels = metrics_full, las = 2)

## Saving plot as .png
png(file = "Plots/AUC_SmoothedEmpiricalData_AllPopns.png", width = 1500, height = 350)
plot(1:10, AUC_df$AUC_data, type = "p", 
     main = "Smoothed Empirical Data, All Populations", xaxt = "none", xlab = "", ylim = c(0.3, 0.7), ylab = "AUC",
     col = "orchid", pch = 19)
abline(h = 0.5, lty = 3)
axis(side = 1, at = 1:10, labels = metrics_full)
dev.off()
```

# Excluding Population 5

```{r}
time.15 <- seq(1,15,1)

warming.mean.tau_without5 <- c(cor(pop6.mean[1:15], time.15, method = "kendall"),
                               cor(pop7.mean[1:15], time.15, method = "kendall"), 
                               cor(pop8.mean[1:15], time.15, method = "kendall"))

warming.skewness.tau_without5 <- c(cor(pop6.skewness[1:15], time.15, method = "kendall"),
                                   cor(pop7.skewness[1:15], time.15, method = "kendall"), 
                                   cor(pop8.skewness[1:15], time.15, method = "kendall"))


warming.kurtosis.tau_without5 <- c(cor(pop6.kurtosis[1:15], time.15, method = "kendall"),
                                   cor(pop7.kurtosis[1:15], time.15, method = "kendall"), 
                                   cor(pop8.kurtosis[1:15], time.15, method = "kendall"))

warming.variance.tau_without5 <- c(cor(pop6.var[1:15], time.15, method = "kendall"),
                                   cor(pop7.var[1:15], time.15, method = "kendall"), 
                                   cor(pop8.var[1:15], time.15, method = "kendall"))

warming.cv.tau_without5 <- c(cor(pop6.cv[1:15], time.15, method = "kendall"),
                             cor(pop7.cv[1:15], time.15, method = "kendall"), 
                             cor(pop8.cv[1:15], time.15, method = "kendall"))

warming.id.tau_without5 <- c(cor(pop6.id[1:15], time.15, method = "kendall"),
                             cor(pop7.id[1:15], time.15, method = "kendall"), 
                             cor(pop8.id[1:15], time.15, method = "kendall"))

warming.ac.tau_without5 <- c(cor(pop6.ac[1:15], time.15, method = "kendall"),
                             cor(pop7.ac[1:15], time.15, method = "kendall"), 
                             cor(pop8.ac[1:15], time.15, method = "kendall"))


warming.cov.tau_without5 <- c(cor(pop6.cov[1:15], time.15, method = "kendall"),
                              cor(pop7.cov[1:15], time.15, method = "kendall"), 
                              cor(pop8.cov[1:15], time.15, method = "kendall"))

warming.first.diff.variance.tau_without5 <- c(cor(pop6.first.diff.variance[1:15], time.15, method = "kendall"),
                                              cor(pop7.first.diff.variance[1:15], time.15, method = "kendall"),
                                              cor(pop8.first.diff.variance[1:15], time.15, method = "kendall"))

warming.decay.time.tau_without5 <- c(cor(pop6.decay.time[1:15], time.15, method = "kendall"),
                                     cor(pop7.decay.time[1:15], time.15, method = "kendall"), 
                                     cor(pop8.decay.time[1:15], time.15, method = "kendall"))
```

## Summarize Outputs

```{r}
AUC_mean_data_without5 <- calc_auc(warming.mean.tau_without5,constant.mean.tau); AUC_mean_data_without5 
AUC_skewness_data_without5 <- calc_auc(warming.skewness.tau_without5,constant.skewness.tau); AUC_skewness_data_without5 
AUC_kurtosis_data_without5 <- calc_auc(warming.kurtosis.tau_without5, constant.kurtosis.tau); AUC_kurtosis_data_without5 
AUC_variance_data_without5 <- calc_auc(warming.variance.tau_without5,constant.variance.tau); AUC_variance_data_without5 
AUC_cv_data_without5 <- calc_auc(warming.cv.tau_without5,constant.cv.tau); AUC_cv_data_without5
AUC_id_data_without5 <- calc_auc(warming.id.tau_without5,constant.id.tau); AUC_id_data_without5 
AUC_first.diff.variance_data_without5 <- calc_auc(warming.first.diff.variance.tau_without5,constant.first.diff.variance.tau); AUC_first.diff.variance_data_without5 
AUC_ac_data_without5 <- calc_auc(warming.ac.tau_without5,constant.ac.tau); AUC_ac_data_without5 
AUC_cov_data_without5 <- calc_auc(warming.cov.tau_without5,constant.cov.tau); AUC_cov_data_without5 
AUC_decay.time_data_without5 <- calc_auc(warming.decay.time.tau_without5,constant.decay.time.tau); AUC_decay.time_data_without5 
```

```{r}
AUC_data <- c(AUC_mean_data_without5,
              AUC_skewness_data_without5,
              AUC_kurtosis_data_without5,
              AUC_variance_data_without5,
              AUC_cv_data_without5,
              AUC_id_data_without5,
              AUC_first.diff.variance_data_without5,
              AUC_ac_data_without5,
              AUC_cov_data_without5,
              AUC_decay.time_data_without5)

AUC_df_without5 <- data.frame(metrics, AUC_data); AUC_df_without5
saveRDS(AUC_df_without5, "Objects/AUC_SmoothedEmpiricalData_ExPop5.rds")
```

A plot!

```{r}
## Plots
plot(1:10, AUC_df_without5$AUC_data, type = "p", 
     main = "Smoothed Empirical Data, Excluding Population 5", xaxt = "none", xlab = "", ylim = c(0, 1), ylab = "AUC",
     col = "red3", pch = 19)
abline(h = 0.5, lty = 3)
axis(side = 1, at = 1:10, labels = metrics_full, las = 2)

plot(1:10, AUC_df$AUC_data, type = "p", 
     main = "Smoothed Empirical Data", xaxt = "none", xlab = "", ylim = c(0, 1), ylab = "AUC",
     col = "orchid", pch = 19)
points(1:10, AUC_df_without5$AUC_data, col = "red3", pch = 19)
abline(h = 0.5, lty = 3)
axis(side = 1, at = 1:10, labels = metrics_full, las = 2)
legend("topright", legend = c("All Populations", "Excluding Population 5"),
       col = c("orchid", "red3"), pch = 19)

## Saving plots as .pngs
png(file = "Plots/AUC_EmpiricalData_ExcludingPopn5.png", width = 1500, height = 350)
plot(1:10, AUC_df_without5$AUC_data, type = "p", 
     main = "Smoothed Empirical Data, Excluding Population 5", xaxt = "none", xlab = "", ylim = c(0, 1), ylab = "AUC",
     col = "red3", pch = 19)
abline(h = 0.5, lty = 3)
axis(side = 1, at = 1:10, labels = metrics_full)
dev.off()

png(file = "Plots/AUC_EmpiricalData.png", width = 1500, height = 350)
plot(1:10, AUC_df$AUC_data, type = "p", 
     main = "Smoothed Empirical Data", xaxt = "none", xlab = "", ylim = c(0, 1), ylab = "AUC",
     col = "orchid", pch = 19)
points(1:10, AUC_df_without5$AUC_data, col = "red3", pch = 19)
abline(h = 0.5, lty = 3)
axis(side = 1, at = 1:10, labels = metrics_full)
legend("topright", legend = c("All Populations", "Excluding Population 5"),
       col = c("orchid", "red3"), pch = 19)
dev.off()
```
